<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Table</title>
    <link rel="stylesheet" href="../public/css/style2.css">
</head>
<body>
    <div class="portfolio-container">
        <header>
            <h1>smart pick</h1>
            <nav>
                <ul>
                    <li><a href="main.html">首頁</a></li>
                    <li><a href="portfolio.html">投資組合</a></li>
                    <li><a href="analysis.html">績效分析</a></li>
                    <li><a href="aboutus.html">關於我們</a></li>
                </ul>
            </nav>
        </header>
        <h1>My Portfolio</h1>
        <table>
            <thead>
                <tr>
                    <th>公司名稱</th>
                    <th>股票代號</th>
                    <th>權重</th>
                    <th>開盤價</th>
                    <th>收盤價</th>
                    <th>成交價</th>
                    <th>最高</th>
                    <th>最低</th>
                    <th>均價</th>
                    <th>漲跌幅</th>
                    <th>總成交量</th>
                </tr>
            </thead>
            <tbody id="portfolioTable">
                <!-- JavaScript 會自動插入資料 -->
            </tbody>
        </table>

        <footer class="footer">
            <div class="footer-content">
                <div class="footer-column">
                    <h4><a href="main.html">首頁</a></h4>
                    <ul>
                        <li><a href="#">TurboJet</a></li>
                        <li><a href="#">DieselJet</a></li>
                        <li><a href="#">SportJet</a></li>
                        <li><a href="#">Yacht Fitment</a></li>
                    </ul>
                </div>
                <div class="footer-column center column">
                    <h4><a href="portfolio.html">投資組合</a></h4>
                    <ul>
                        <li><a href="#">Build My Tender</a></li>
                        <li><a href="#">Contact Us</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4><a href="analysis.html">績效分析</a></h4>
                    <ul>
                        <li><a href="#">Find a Dealer</a></li>
                        <li><a href="#">Dealer Login</a></li>
                    </ul>
                </div>
                <div class="footer-column">
                    <h4><a href="aboutus.html">關於我們</a></h4>
                    <ul>
                        <li><a href="#">Find a Dealer</a></li>
                        <li><a href="#">Dealer Login</a></li>
                    </ul>
                </div>

                <div class="newsletter-signup">
                    <h4>MORE INFORMATION</h4>
                    <input type="email" placeholder="Email address">
                    <button>SUBSCRIBE</button>
                </div>
            </div>    
            <div class="footer-bottom">
                <p>Copyright © 2024 National Taipei University of Technology. All rights reserved. </p>
            </div>
        </footer>
    </div>

    <!-- 彈出視窗區域，用於顯示公司詳情 -->
    <div id="stockModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalTitle"></h2>
            <p id="stockPrice"></p>
            <canvas id="chartContainer" style="height: 300px; width: 100%;"></canvas>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- 用於折線圖 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- 引入 jQuery -->

    <script>
        // 保留您原本的股票代號和公司名稱陣列
        const stock_ids = [
            '2330', '2317', '2454', '2308', '2382', '2891', '2881', '2303', '3711', '2882',
            '2886', '2412', '2884', '1216', '2885', '3034', '2357', '2890', '2892', '3231',
            '2345', '3008', '2327', '5880', '2002', '2880', '2379', '1303', '2883', '6669',
            '1101', '2887', '3037', '2301', '3017', '1301', '4938', '2207', '3661', '2603',
            '2395', '3045', '5876', '1326', '4904', '2912', '1590', '5871', '6505', '2408'
        ];
        
        const company_names = [
            '台積電', '鴻海', '聯發科', '台達電', '廣達', '中信金', '富邦金', '聯華電子', '日月光投控', '國泰金',
            '兆豐金', '中華電', '玉山金', '統一', '元大金', '聯詠', '華碩', '永豐金', '第一金', '緯創',
            '智邦', '大立光', '國巨', '合庫金', '中鋼', '華南金', '瑞昱', '南亞', '凱基', '緯穎',
            '台泥', '台新金', '欣興', '光寶', '奇鋐', '台塑', '和碩', '和泰', '世芯', '長榮',
            '研華', '台灣大哥大', '上海商銀', '台化', '遠傳', '統一超', '亞德客', '中租-KY', '台塑', '南亞科'
        ];

        function populateTable() {
            const tableBody = document.getElementById('portfolioTable');
            let rows = '';

            for (let i = 0; i < stock_ids.length; i++) {
                rows += `
                    <tr onclick="showStockInfo('${stock_ids[i]}', '${company_names[i]}')">
                        <td>${company_names[i]}</td>
                        <td>${stock_ids[i]}</td>
                        <td>—</td>
                        <td>—</td>
                        <td>—</td>
                        <td>—</td>
                        <td>—</td>
                        <td>—</td>
                        <td>—</td>
                        <td>—</td>
                        <td>—</td>
                    </tr>
                `;
            }
            tableBody.innerHTML = rows;
        }

        function showStockInfo(stockId, companyName) {
            document.getElementById('modalTitle').textContent = companyName;
            $('#stockModal').fadeIn();

            fetchStockData(stockId);
        }

        function fetchStockData(stockId) {
            // 'YOUR_API_KEY'
            const apiKey = 'HSYVXS8Y3R27T54M';
            fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${stockId}.TW&apikey=${apiKey}`)
                .then(response => response.json())
                .then(data => {
                    if (data['Time Series (Daily)']) {
                        const timeSeries = data['Time Series (Daily)'];
                        const labels = [];
                        const prices = [];
                        
                        for (let date in timeSeries) {
                            labels.push(date);
                            prices.push(timeSeries[date]['4. close']);
                        }
                        
                        updateChart(labels.reverse(), prices.reverse());
                        document.getElementById('stockPrice').textContent = `最新收盤價: ${prices[0]}`;
                    }
                })
                .catch(error => {
                    console.error('取得股票資料時發生錯誤：', error);
                    document.getElementById('stockPrice').textContent = '資料獲取錯誤，請稍後再試。';
        });
        }

        function updateChart(labels, prices) {
            const ctx = document.getElementById('chartContainer').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '股價趨勢',
                        data: prices,
                        borderColor: 'rgba(75, 192, 192, 1)',
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        x: { display: true },
                        y: { display: true }
                    }
                }
            });
        }

        document.querySelector('.close').onclick = function() {
            $('#stockModal').fadeOut();
        };

        populateTable();
    </script>

    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 700px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
    </style>
</body>
</html>
